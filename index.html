<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Clone - Video Chat</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #36393f; color: white; display: flex; flex-direction: column; align-items: center; }
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 10px; width: 90%; margin-top: 20px; }
        video { width: 100%; background: #2f3136; border-radius: 8px; transform: scaleX(-1); }
        .controls { margin-top: 20px; background: #2f3136; padding: 20px; border-radius: 10px; }
        input { padding: 10px; border-radius: 5px; border: none; }
        button { padding: 10px 20px; background: #5865f2; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #4752c4; }
    </style>
</head>
<body>

    <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ Ø§Ù„Ù…ØµØºØ± ğŸš€</h2>
    
    <div class="controls">
        <p>Ù…Ø¹Ø±ÙÙƒ Ø§Ù„Ø®Ø§Øµ: <strong id="my-id">... Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</strong></p>
        <input type="text" id="peer-id" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù ØµØ¯ÙŠÙ‚Ùƒ">
        <button onclick="connectToPeer()">Ø§ØªØµØ§Ù„ ÙÙŠØ¯ÙŠÙˆ</button>
    </div>

    <div class="video-grid" id="video-grid">
        <video id="local-video" autoplay muted></video>
    </div>

    <script>
        const peer = new Peer(); // Ø¥Ù†Ø´Ø§Ø¡ Ø§ØªØµØ§Ù„ Ø¬Ø¯ÙŠØ¯
        const videoGrid = document.getElementById('video-grid');
        const localVideo = document.getElementById('local-video');
        let myStream;

        // 1. Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
        navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
            myStream = stream;
            localVideo.srcObject = stream;
        });

        // 2. Ø¹Ø±Ø¶ Ù…Ø¹Ø±ÙÙƒ Ø§Ù„Ø®Ø§Øµ (ID) Ù„ØªØ¹Ø·ÙŠÙ‡ Ù„ØµØ¯ÙŠÙ‚Ùƒ
        peer.on('open', id => {
            document.getElementById('my-id').innerText = id;
        });

        // 3. Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©
        peer.on('call', call => {
            call.answer(myStream); // Ø§Ù„Ø±Ø¯ Ø¨Ù…Ù‚Ø·Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
            const video = document.createElement('video');
            call.on('stream', userVideoStream => {
                addVideoStream(video, userVideoStream);
            });
        });

        // 4. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ØµØ¯ÙŠÙ‚
        function connectToPeer() {
            const friendId = document.getElementById('peer-id').value;
            const call = peer.call(friendId, myStream);
            const video = document.createElement('video');
            call.on('stream', userVideoStream => {
                addVideoStream(video, userVideoStream);
            });
        }

        function addVideoStream(video, stream) {
            video.srcObject = stream;
            video.addEventListener('loadedmetadata', () => {
                video.play();
            });
            videoGrid.append(video);
        }
    </script>
</body>
</html>
